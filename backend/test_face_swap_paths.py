#!/usr/bin/env python3\n\"\"\"\næ¢è„¸è·¯å¾„é…ç½®æµ‹è¯•è„šæœ¬\nä¸“é—¨æµ‹è¯•è·¯å¾„æŸ¥æ‰¾å’Œæ¨¡å‹æ£€æµ‹é€»è¾‘\n\"\"\"\n\nimport os\nimport sys\n\n# æ·»åŠ å½“å‰ç›®å½•åˆ°è·¯å¾„\ncurrent_dir = os.path.dirname(os.path.abspath(__file__))\nif current_dir not in sys.path:\n    sys.path.insert(0, current_dir)\n\ndef test_faceswap_path_detection():\n    \"\"\"æµ‹è¯•faceswapè·¯å¾„æ£€æµ‹\"\"\"\n    print(\"ğŸ” æµ‹è¯•faceswapè·¯å¾„æ£€æµ‹åŠŸèƒ½...\")\n    \n    possible_paths = [\n        \"/runpod-volume/faceswap\",  # RunPodä¸»è¦è·¯å¾„\n        \"/Users/baileyli/Documents/AIåŒå¿—é¡¹ç›®/image generation/faceswap\",  # æœ¬åœ°å¼€å‘\n        \"/app/faceswap\",  # Dockerå®¹å™¨\n        \"/workspace/faceswap\",  # RunPodå¤‡ç”¨\n        \"../faceswap\",  # ç›¸å¯¹è·¯å¾„\n        \"./faceswap\"  # å½“å‰ç›®å½•\n    ]\n    \n    print(\"ğŸ“ æ£€æŸ¥å¯èƒ½çš„faceswapè·¯å¾„:\")\n    found_paths = []\n    for path in possible_paths:\n        exists = os.path.exists(path)\n        status = \"âœ…\" if exists else \"âŒ\"\n        print(f\"  {status} {path}\")\n        if exists:\n            found_paths.append(path)\n    \n    if found_paths:\n        print(f\"\\nâœ… æ‰¾åˆ° {len(found_paths)} ä¸ªæœ‰æ•ˆè·¯å¾„\")\n        return found_paths[0]  # è¿”å›ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„è·¯å¾„\n    else:\n        print(\"\\nâŒ æœªæ‰¾åˆ°ä»»ä½•æœ‰æ•ˆçš„faceswapè·¯å¾„\")\n        return None\n\ndef test_model_files_detection(base_path):\n    \"\"\"æµ‹è¯•æ¨¡å‹æ–‡ä»¶æ£€æµ‹\"\"\"\n    print(f\"\\nğŸ” æµ‹è¯•æ¨¡å‹æ–‡ä»¶æ£€æµ‹ (åŸºè·¯å¾„: {base_path})...\")\n    \n    if not base_path or not os.path.exists(base_path):\n        print(\"âŒ åŸºè·¯å¾„ä¸å­˜åœ¨ï¼Œæ— æ³•æ£€æµ‹æ¨¡å‹æ–‡ä»¶\")\n        return False\n    \n    model_files = {\n        \"face_swap\": \"inswapper_128_fp16.onnx\",\n        \"face_enhance\": \"GFPGANv1.4.pth\", \n        \"face_analysis\": \"buffalo_l\"\n    }\n    \n    all_found = True\n    print(\"ğŸ“„ æ£€æŸ¥æ¨¡å‹æ–‡ä»¶:\")\n    \n    for model_type, filename in model_files.items():\n        full_path = os.path.join(base_path, filename)\n        exists = os.path.exists(full_path)\n        status = \"âœ…\" if exists else \"âŒ\"\n        print(f\"  {status} {model_type}: {filename}\")\n        if exists:\n            # æ˜¾ç¤ºæ–‡ä»¶å¤§å°\n            try:\n                size = os.path.getsize(full_path)\n                size_mb = size / (1024 * 1024)\n                print(f\"      æ–‡ä»¶å¤§å°: {size_mb:.1f} MB\")\n            except Exception as e:\n                print(f\"      æ— æ³•è·å–æ–‡ä»¶å¤§å°: {e}\")\n        if not exists:\n            all_found = False\n    \n    return all_found\n\ndef search_model_files_recursively():\n    \"\"\"é€’å½’æœç´¢æ¨¡å‹æ–‡ä»¶\"\"\"\n    print(\"\\nğŸ” é€’å½’æœç´¢æ¢è„¸æ¨¡å‹æ–‡ä»¶...\")\n    \n    search_keywords = [\"inswapper\", \"buffalo\", \"gfpgan\"]\n    search_roots = [\"/runpod-volume\", \"/workspace\", \"/app\", \".\", \"..\"]\n    \n    found_files = []\n    \n    for root in search_roots:\n        if not os.path.exists(root):\n            continue\n            \n        print(f\"ğŸ“ æœç´¢ç›®å½•: {root}\")\n        try:\n            for dirpath, dirnames, filenames in os.walk(root):\n                for filename in filenames:\n                    for keyword in search_keywords:\n                        if keyword.lower() in filename.lower():\n                            full_path = os.path.join(dirpath, filename)\n                            print(f\"  ğŸ” æ‰¾åˆ°: {full_path}\")\n                            found_files.append(full_path)\n                            break\n        except Exception as e:\n            print(f\"  âŒ æœç´¢å¤±è´¥: {e}\")\n    \n    return found_files\n\ndef test_handler_integration():\n    \"\"\"æµ‹è¯•handleré›†æˆ\"\"\"\n    print(\"\\nğŸ” æµ‹è¯•handleré›†æˆ...\")\n    \n    try:\n        import handler\n        print(\"âœ… handleræ¨¡å—å¯¼å…¥æˆåŠŸ\")\n        \n        # æµ‹è¯•æ¢è„¸è·¯å¾„å‡½æ•°\n        if hasattr(handler, 'add_faceswap_path'):\n            print(\"âœ… add_faceswap_pathå‡½æ•°å­˜åœ¨\")\n            result = handler.add_faceswap_path()\n            print(f\"ğŸ“ è·¯å¾„æ£€æµ‹ç»“æœ: {result}\")\n        else:\n            print(\"âŒ add_faceswap_pathå‡½æ•°ä¸å­˜åœ¨\")\n        \n        # æµ‹è¯•æ¨¡å‹é…ç½®å‡½æ•°\n        if hasattr(handler, 'get_face_swap_models_config'):\n            print(\"âœ… get_face_swap_models_configå‡½æ•°å­˜åœ¨\")\n            config = handler.get_face_swap_models_config()\n            print(\"ğŸ“ æ¨¡å‹é…ç½®:\")\n            for key, path in config.items():\n                exists = os.path.exists(path)\n                status = \"âœ…\" if exists else \"âŒ\"\n                print(f\"  {status} {key}: {path}\")\n        else:\n            print(\"âŒ get_face_swap_models_configå‡½æ•°ä¸å­˜åœ¨\")\n        \n        # æµ‹è¯•æ¢è„¸å¯ç”¨æ€§æ£€æŸ¥\n        if hasattr(handler, 'is_face_swap_available'):\n            print(\"\\nâœ… is_face_swap_availableå‡½æ•°å­˜åœ¨\")\n            print(\"ğŸ”„ æ‰§è¡Œæ¢è„¸å¯ç”¨æ€§æ£€æŸ¥...\")\n            is_available = handler.is_face_swap_available()\n            print(f\"ğŸ“ æ¢è„¸åŠŸèƒ½å¯ç”¨: {is_available}\")\n        else:\n            print(\"âŒ is_face_swap_availableå‡½æ•°ä¸å­˜åœ¨\")\n        \n        return True\n        \n    except Exception as e:\n        print(f\"âŒ handleræµ‹è¯•å¤±è´¥: {e}\")\n        import traceback\n        print(f\"ğŸ“ é”™è¯¯è¯¦æƒ…: {traceback.format_exc()}\")\n        return False\n\ndef main():\n    \"\"\"ä¸»æµ‹è¯•å‡½æ•°\"\"\"\n    print(\"ğŸš€ æ¢è„¸è·¯å¾„é…ç½®æµ‹è¯•å¼€å§‹\")\n    print(\"=\"*60)\n    \n    # 1. æµ‹è¯•è·¯å¾„æ£€æµ‹\n    found_path = test_faceswap_path_detection()\n    \n    # 2. æµ‹è¯•æ¨¡å‹æ–‡ä»¶æ£€æµ‹\n    if found_path:\n        test_model_files_detection(found_path)\n    else:\n        print(\"\\nâš ï¸ è·³è¿‡æ¨¡å‹æ–‡ä»¶æ£€æµ‹ï¼ˆæœªæ‰¾åˆ°åŸºè·¯å¾„ï¼‰\")\n    \n    # 3. é€’å½’æœç´¢\n    search_model_files_recursively()\n    \n    # 4. æµ‹è¯•handleré›†æˆ\n    test_handler_integration()\n    \n    print(\"\\n\" + \"=\"*60)\n    print(\"ğŸ‰ æµ‹è¯•å®Œæˆ\")\n\nif __name__ == \"__main__\":\n    main() 