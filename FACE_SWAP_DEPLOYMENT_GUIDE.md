# æ¢è„¸åŠŸèƒ½éƒ¨ç½²æŒ‡å—\n\n## é—®é¢˜è¯Šæ–­ç»“æœ\n\næ ¹æ®logsåˆ†æï¼Œæ¢è„¸åŠŸèƒ½æ— æ³•ä½¿ç”¨çš„ä¸»è¦åŸå› ï¼š\n\n### 1. ä¾èµ–åº“ç¼ºå¤±\n```\nâš ï¸ InsightFace not available - face swap will be disabled: No module named 'insightface'\nâš ï¸ GFPGAN not available - face enhancement will be disabled: No module named 'gfpgan'\n```\n\n### 2. æ¨¡å‹æ–‡ä»¶ç¼ºå¤±\n```\nâš ï¸ Face swap models not available - face swap will be disabled\n```\n\n## è§£å†³æ–¹æ¡ˆ\n\n### æ­¥éª¤1: å®‰è£…ä¾èµ–åº“\n\nåœ¨RunPodå®¹å™¨ä¸­å®‰è£…æ¢è„¸ä¾èµ–ï¼š\n\n```bash\n# è¿›å…¥å®¹å™¨åæ‰§è¡Œ\npip install insightface onnxruntime-gpu\n\n# å¯é€‰ï¼šå®‰è£…GFPGANï¼ˆå¦‚æœéœ€è¦é¢éƒ¨å¢å¼ºï¼‰\npip install gfpgan basicsr facexlib\n```\n\n### æ­¥éª¤2: ä¸‹è½½æ¨¡å‹æ–‡ä»¶\n\nåœ¨RunPodç¯å¢ƒä¸­åˆ›å»ºæ¨¡å‹ç›®å½•å¹¶ä¸‹è½½å¿…è¦çš„æ¨¡å‹ï¼š\n\n```bash\n# åˆ›å»ºæ¨¡å‹ç›®å½•\nmkdir -p /runpod-volume/faceswap\ncd /runpod-volume/faceswap\n\n# ä¸‹è½½InsightFaceæ¨¡å‹\nwget https://github.com/deepinsight/insightface/releases/download/v0.7/buffalo_l.zip\nunzip buffalo_l.zip\n\n# ä¸‹è½½æ¢è„¸æ¨¡å‹\nwget https://github.com/facefusion/facefusion-assets/releases/download/models/inswapper_128_fp16.onnx\n\n# å¯é€‰ï¼šä¸‹è½½GFPGANæ¨¡å‹\nwget https://github.com/TencentARC/GFPGAN/releases/download/v1.3.0/GFPGANv1.4.pth\n```\n\n### æ­¥éª¤3: éªŒè¯å®‰è£…\n\nè¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯æ¢è„¸åŠŸèƒ½ï¼š\n\n```bash\ncd /app\npython -c \"\nimport handler\nprint('ğŸ” æ£€æŸ¥æ¢è„¸åŠŸèƒ½å¯ç”¨æ€§...')\nresult = handler.is_face_swap_available()\nprint(f'ğŸ“ æ¢è„¸åŠŸèƒ½å¯ç”¨: {result}')\n\"\n```\n\n## é¢„æœŸçš„ç›®å½•ç»“æ„\n\n```\n/runpod-volume/faceswap/\nâ”œâ”€â”€ buffalo_l/                    # InsightFaceäººè„¸åˆ†ææ¨¡å‹\nâ”‚   â”œâ”€â”€ 1k3d68.onnx\nâ”‚   â”œâ”€â”€ 2d106det.onnx\nâ”‚   â”œâ”€â”€ det_10g.onnx\nâ”‚   â”œâ”€â”€ genderage.onnx\nâ”‚   â””â”€â”€ w600k_r50.onnx\nâ”œâ”€â”€ inswapper_128_fp16.onnx        # æ¢è„¸æ¨¡å‹\nâ””â”€â”€ GFPGANv1.4.pth                # é¢éƒ¨å¢å¼ºæ¨¡å‹ï¼ˆå¯é€‰ï¼‰\n```\n\n## ä»£ç ä¿®å¤è¯´æ˜\n\n### 1. è·¯å¾„æ£€æµ‹ä¼˜åŒ–\n\næ›´æ–°äº†`add_faceswap_path()`å‡½æ•°ï¼Œä¼˜å…ˆæ£€æŸ¥RunPodè·¯å¾„ï¼š\n\n```python\npossible_paths = [\n    \"/runpod-volume/faceswap\",  # RunPodä¸»è¦è·¯å¾„\n    \"/Users/baileyli/Documents/AIåŒå¿—é¡¹ç›®/image generation/faceswap\",  # æœ¬åœ°å¼€å‘\n    \"/app/faceswap\",  # Dockerå®¹å™¨\n    \"/workspace/faceswap\",  # RunPodå¤‡ç”¨\n    \"../faceswap\",  # ç›¸å¯¹è·¯å¾„\n    \"./faceswap\"  # å½“å‰ç›®å½•\n]\n```\n\n### 2. åŠ¨æ€æ¨¡å‹é…ç½®\n\nå®ç°äº†`get_face_swap_models_config()`å‡½æ•°ï¼ŒåŠ¨æ€æŸ¥æ‰¾æ¨¡å‹è·¯å¾„ï¼š\n\n```python\ndef get_face_swap_models_config():\n    \"\"\"åŠ¨æ€è·å–æ¢è„¸æ¨¡å‹è·¯å¾„é…ç½®\"\"\"\n    possible_base_paths = [\n        \"/runpod-volume/faceswap\",\n        \"/workspace/faceswap\", \n        \"/app/faceswap\",\n        \"./models/faceswap\",\n        \"./faceswap\"\n    ]\n    \n    for base_path in possible_base_paths:\n        if os.path.exists(base_path):\n            return {\n                \"face_swap\": os.path.join(base_path, \"inswapper_128_fp16.onnx\"),\n                \"face_enhance\": os.path.join(base_path, \"GFPGANv1.4.pth\"), \n                \"face_analysis\": os.path.join(base_path, \"buffalo_l\")\n            }\n```\n\n### 3. å¢å¼ºé”™è¯¯è¯Šæ–­\n\næ”¹è¿›äº†`is_face_swap_available()`å‡½æ•°ï¼Œæä¾›è¯¦ç»†çš„è¯Šæ–­ä¿¡æ¯ï¼š\n\n- æ£€æŸ¥ä¾èµ–åº“å¯ç”¨æ€§\n- æ£€æŸ¥æ¨¡å‹æ–‡ä»¶å­˜åœ¨æ€§\n- é€’å½’æœç´¢å¯èƒ½çš„æ¨¡å‹ä½ç½®\n- æä¾›è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Š\n\n### 4. Dockerfileä¼˜åŒ–\n\næ›´æ–°äº†Dockerfileï¼Œç¡®ä¿æ¢è„¸ä¾èµ–çš„å®‰è£…ï¼š\n\n```dockerfile\n# Install face swap dependencies separately (allows graceful failure)\nRUN pip install insightface onnxruntime-gpu || echo \"âš ï¸ æ¢è„¸ä¾èµ–å®‰è£…å¤±è´¥ï¼Œå°†åœ¨è¿è¡Œæ—¶å°è¯•\"\n```\n\n## éƒ¨ç½²æ£€æŸ¥æ¸…å•\n\n- [ ] ç¡®è®¤InsightFaceåº“å·²å®‰è£…\n- [ ] ç¡®è®¤onnxruntime-gpuå·²å®‰è£…\n- [ ] ç¡®è®¤æ¨¡å‹ç›®å½•`/runpod-volume/faceswap`å­˜åœ¨\n- [ ] ç¡®è®¤buffalo_læ¨¡å‹æ–‡ä»¶å¤¹å­˜åœ¨\n- [ ] ç¡®è®¤inswapper_128_fp16.onnxæ–‡ä»¶å­˜åœ¨\n- [ ] è¿è¡Œæµ‹è¯•éªŒè¯æ¢è„¸åŠŸèƒ½å¯ç”¨\n\n## æ•…éšœæ’é™¤\n\n### å¦‚æœä¾èµ–å®‰è£…å¤±è´¥\n\n```bash\n# æ‰‹åŠ¨å®‰è£…InsightFace\npip install --upgrade pip\npip install insightface --no-deps\npip install onnxruntime-gpu\n\n# å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œå°è¯•CPUç‰ˆæœ¬\npip install onnxruntime\n```\n\n### å¦‚æœæ¨¡å‹ä¸‹è½½å¤±è´¥\n\nå¯ä»¥ä½¿ç”¨å¤‡ç”¨ä¸‹è½½é“¾æ¥æˆ–æ‰‹åŠ¨ä¸Šä¼ æ¨¡å‹æ–‡ä»¶åˆ°RunPod volumeã€‚\n\n### å¦‚æœè·¯å¾„æ£€æµ‹å¤±è´¥\n\næ£€æŸ¥logsä¸­çš„è·¯å¾„æ£€æµ‹ä¿¡æ¯ï¼Œç¡®è®¤æ¨¡å‹æ–‡ä»¶æ”¾åœ¨æ­£ç¡®çš„ä½ç½®ã€‚\n\n## æµ‹è¯•å‘½ä»¤\n\n```bash\n# æµ‹è¯•ä¾èµ–\npython -c \"import insightface; print('InsightFace OK')\"\npython -c \"import onnxruntime; print('ONNX Runtime OK')\"\n\n# æµ‹è¯•è·¯å¾„\npython -c \"import os; print('Models exist:', os.path.exists('/runpod-volume/faceswap/inswapper_128_fp16.onnx'))\"\n\n# å®Œæ•´æµ‹è¯•\npython backend/test_face_swap_paths_fixed.py\n```\n\n## é¢„æœŸç»“æœ\n\næˆåŠŸé…ç½®åï¼Œlogsåº”è¯¥æ˜¾ç¤ºï¼š\n\n```\nâœ… æ¢è„¸ä¾èµ–åº“æ£€æŸ¥é€šè¿‡\nâœ… æ¨¡å‹å­˜åœ¨: face_swap at /runpod-volume/faceswap/inswapper_128_fp16.onnx\nâœ… æ¨¡å‹å­˜åœ¨: face_analysis at /runpod-volume/faceswap/buffalo_l\nâœ“ Face swap integration loaded successfully (embedded)\n```\n\nè€Œä¸æ˜¯ï¼š\n\n```\nâš ï¸ InsightFace not available - face swap will be disabled\nâš ï¸ Face swap models not available - face swap will be disabled\n``` 