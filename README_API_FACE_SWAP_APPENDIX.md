# APIæ¢è„¸æŠ€æœ¯ç»†èŠ‚é™„å½•

## Base64è§£ç ä¿®å¤æŠ€æœ¯ç»†èŠ‚

### é—®é¢˜èƒŒæ™¯

ç”¨æˆ·æŠ¥å‘Šï¼š"âŒ Base64è§£ç å¤±è´¥: cannot identify image file"ï¼Œç»è¯Šæ–­å‘ç°APIè¿”å›çš„æ˜¯Data URIæ ¼å¼ï¼ˆ`data:image/jpeg;base64,`ï¼‰ï¼Œä¸”Base64æ•°æ®è¢«æˆªæ–­ã€‚

### Fallbackç­–ç•¥å®ç°

ç³»ç»Ÿå®ç°äº†5ç§ä¸åŒçš„è§£ç æ–¹æ³•ï¼ŒæŒ‰ä¼˜å…ˆçº§å°è¯•ï¼š

1. **åŸå§‹æ•°æ®**: ç›´æ¥å°è¯•è§£ç APIè¿”å›çš„æ•°æ®
2. **è‡ªåŠ¨å¡«å……**: æ·»åŠ æ­£ç¡®çš„Base64å¡«å……å­—ç¬¦ï¼ˆ=ï¼‰
3. **ç§»é™¤æœ€å1å­—ç¬¦**: å¤„ç†æˆªæ–­æ•°æ®ï¼ˆæœ€å¸¸è§çš„ä¿®å¤æ–¹æ³•ï¼‰
4. **ç§»é™¤æœ€å2å­—ç¬¦**: å¤„ç†æ›´ä¸¥é‡çš„æˆªæ–­
5. **ç§»é™¤æœ€å3å­—ç¬¦**: å¤„ç†ä¸¥é‡æŸåçš„æ•°æ®

### Data URIå¤„ç†æµç¨‹

```python
def process_data_uri(result_data):
    if result_data.startswith(('http://', 'https://')):
        # URLæ ¼å¼ï¼šç›´æ¥ä¸‹è½½
        return download_image_from_url(result_data)
    elif result_data.startswith('data:image/'):
        # Data URIæ ¼å¼ï¼šåˆ†å‰²å¹¶è§£ç 
        header, base64_data = result_data.split(',', 1)
        return try_decode_base64_with_fallback(base64_data)
    else:
        # çº¯Base64æ ¼å¼ï¼šç›´æ¥è§£ç 
        return decode_pure_base64(result_data)
```

### é”™è¯¯æ¢å¤æœºåˆ¶

å½“æ‰€æœ‰è§£ç æ–¹æ³•éƒ½æ— æ³•äº§ç”Ÿæœ‰æ•ˆå›¾åƒæ—¶ï¼š
- ä½¿ç”¨æœ€åä¸€ä¸ªæˆåŠŸè§£ç çš„Base64æ•°æ®
- åˆ›å»ºfallbackå›¾åƒç¡®ä¿æµç¨‹ç»§ç»­
- è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯ç”¨äºè°ƒè¯•

è¿™ç¡®ä¿äº†å³ä½¿åœ¨APIè¿”å›æŸåæ•°æ®çš„æƒ…å†µä¸‹ï¼Œæ¢è„¸æµç¨‹ä»ç„¶å¯ä»¥ç»§ç»­å®Œæˆã€‚

### ä¿®å¤å‰åå¯¹æ¯”

**ä¿®å¤å‰:**
```
âŒ Base64è§£ç å¤±è´¥: cannot identify image file
```

**ä¿®å¤å:**
```
ğŸ”§ å°è¯•æ–¹æ³•: ç§»é™¤æœ€å1å­—ç¬¦ (é•¿åº¦: 176, ä½™æ•°: 0)
   âœ… Base64è§£ç æˆåŠŸ: 132 å­—èŠ‚
âœ… ç§»é™¤æœ€å1å­—ç¬¦å®Œå…¨æˆåŠŸ: å›¾åƒ (512, 512)
âœ… APIæ¢è„¸æˆåŠŸå®Œæˆ (Data URI)
```

### æµ‹è¯•éªŒè¯

æ‰€æœ‰ä¿®å¤å·²é€šè¿‡å®Œæ•´æµ‹è¯•ï¼š
- âœ… åŸºç¡€è§£ç ä¿®å¤: é€šè¿‡
- âœ… å®Œæ•´æµç¨‹å¤„ç†: é€šè¿‡  
- âœ… å„ç§åœºæ™¯æµ‹è¯•: é€šè¿‡

ç”¨æˆ·çš„æ¢è„¸åŠŸèƒ½ç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ 